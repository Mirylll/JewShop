@page "/forgot-password"
@inject IAuthService AuthService

<div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
    <div class="card shadow-lg p-4 border-0" style="width: 100%; max-width: 450px; border-radius: 15px;">
        <div class="text-center mb-4">
            <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-inline-flex p-3 mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-envelope-exclamation" viewBox="0 0 16 16">
                  <path d="M2 2a2 2 0 0 0-2 2v8.01A2 2 0 0 0 2 14h5.5a.5.5 0 0 0 0-1H2a1 1 0 0 1-1-1V5.5L8 9.25l5.75-3.75a1 1 0 0 1 1 .5V8a.5.5 0 0 0 1 0V4a2 2 0 0 0-2-2H2Zm-.05 3.55.57-.38L8 8.75l5.48-3.58a2 2 0 0 0-.96-.17H2.48c-.32 0-.64.06-.93.17Z"/>
                  <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1.5a.5.5 0 0 1-1 0V11a.5.5 0 0 1 1 0Zm0 3a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z"/>
                </svg>
            </div>
            <h3 class="fw-bold">Quên Mật Khẩu?</h3>
            <p class="text-muted small">Đừng lo! Nhập email của bạn và chúng tôi sẽ gửi hướng dẫn khôi phục.</p>
        </div>
        
        @if (isSent)
        {
            <div class="alert alert-success text-center border-0 bg-success-subtle text-success">
                <i class="bi bi-check-circle-fill fs-4 d-block mb-2"></i>
                <strong>Đã gửi yêu cầu!</strong><br/>
                Vui lòng kiểm tra <b>Console Server</b> (do chưa có email thật) để lấy link đặt lại mật khẩu.
            </div>
            <div class="text-center mt-3">
                <a href="/login" class="btn btn-outline-secondary w-100">Quay lại Đăng nhập</a>
            </div>
        }
        else
        {
            @if (showError)
            {
                <div class="alert alert-danger text-center small py-2">Email không tồn tại trong hệ thống.</div>
            }

            <div class="mb-4">
                <label class="form-label fw-bold small text-secondary">Email đăng ký</label>
                <input @bind="email" class="form-control form-control-lg" placeholder="name@example.com" />
            </div>
            
            <button class="btn btn-primary w-100 py-2 fw-bold shadow-sm mb-3" @onclick="HandleSubmit" disabled="@isLoading">
                @if(isLoading) { <span class="spinner-border spinner-border-sm"></span> } 
                else { <span>Gửi Yêu Cầu</span> }
            </button>
            
            <div class="text-center">
                <a href="/login" class="text-decoration-none small text-muted">
                    <i class="bi bi-arrow-left"></i> Quay lại Đăng nhập
                </a>
            </div>
        }
    </div>
</div>

@code {
    private string email = "";
    private bool isSent = false;
    private bool isLoading = false;
    private bool showError = false;

    private async Task HandleSubmit()
    {
        if(!string.IsNullOrEmpty(email))
        {
            isLoading = true;
            showError = false;
            
            // Gọi API thật
            bool success = await AuthService.ForgotPassword(email);
            
            if (success) isSent = true;
            else showError = true;
            
            isLoading = false;
        }
    }
}